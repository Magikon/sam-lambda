create or replace procedure sp_agent_profiles_increment()
as $$ 
BEGIN
delete from agent_profiles 
using agent_profiles_stage 
where agent_profiles.account_id = agent_profiles_stage.account_id
and   agent_profiles.agent_id = agent_profiles_stage.agent_id ;

insert into agent_profiles( 
account_end_date,
account_id,
account_start_date,
active,
age,
agent_id,
agent_status_id,
assistant,
avg_tenure,
branch_group,
branch_id,
branch,
brokers_outpost_profile,
channel,
college,
created_at,
days_account_lead,
days_account,
duplicate,
eligible_branch,
email,
employer_count,
encompass_name,
encompass_name2,
fb_profile,
first_name,
gender,
graduation_year,
home_city,
home_country,
home_state,
industry_start_date,
last_name,
license_count,
license_list,
license_status,
license_type,
linkedin_profile,
lo_close_rate_2017,
lo_close_rate,
lo_cluster1_cr,
lo_cluster1,
lo_cluster2_cr,
lo_cluster2,
lo_cluster3_cr,
lo_cluster3,
lo_contact_rate_2017,
lo_contact_rate,
lo_event_all_action_lost,
lo_event_all_action_per_lead_lost,
lo_event_all_action_per_lead_rate_lost,
lo_event_all_action_per_lead_rate_won,
lo_event_all_action_per_lead_rate,
lo_event_all_action_per_lead_won,
lo_event_all_action_per_lead,
lo_event_all_action_rate_lost,
lo_event_all_action_rate_won,
lo_event_all_action_rate,
lo_event_all_action_won,
lo_event_all_action,
lo_event_lead_action_lost,
lo_event_lead_action_per_lead_lost,
lo_event_lead_action_per_lead_rate_lost,
lo_event_lead_action_per_lead_rate_won,
lo_event_lead_action_per_lead_rate,
lo_event_lead_action_per_lead_won,
lo_event_lead_action_per_lead,
lo_event_lead_action_rate_lost,
lo_event_lead_action_rate_won,
lo_event_lead_action_rate,
lo_event_lead_action_won,
lo_event_lead_action,
lo_event_lo_action_lost,
lo_event_lo_action_per_lead_lost,
lo_event_lo_action_per_lead_rate_lost,
lo_event_lo_action_per_lead_rate_won,
lo_event_lo_action_per_lead_rate,
lo_event_lo_action_per_lead_won,
lo_event_lo_action_per_lead,
lo_event_lo_action_rate_lost,
lo_event_lo_action_rate_won,
lo_event_lo_action_rate,
lo_event_lo_action_won,
lo_event_lo_action,
lo_event_lost,
lo_event_negative_lost,
lo_event_negative_per_lead_lost,
lo_event_negative_per_lead_rate_lost,
lo_event_negative_per_lead_rate_won,
lo_event_negative_per_lead_rate,
lo_event_negative_per_lead_won,
lo_event_negative_per_lead,
lo_event_negative_rate_lost,
lo_event_negative_rate_won,
lo_event_negative_rate,
lo_event_negative_won,
lo_event_negative,
lo_event_per_lead_lost,
lo_event_per_lead_won,
lo_event_per_lead,
lo_event_rate_lost,
lo_event_rate_won,
lo_event_rate,
lo_event_won,
lo_event,
lo_lead_2017,
lo_lead_all_action_lost,
lo_lead_all_action_per_lead_lost,
lo_lead_all_action_per_lead_rate_lost,
lo_lead_all_action_per_lead_rate_won,
lo_lead_all_action_per_lead_rate,
lo_lead_all_action_per_lead_won,
lo_lead_all_action_per_lead,
lo_lead_all_action_rate_lost,
lo_lead_all_action_rate_won,
lo_lead_all_action_rate,
lo_lead_all_action_won,
lo_lead_all_action,
lo_lead_contact_2017,
lo_lead_contact,
lo_lead_lead_action_lost,
lo_lead_lead_action_per_lead_lost,
lo_lead_lead_action_per_lead_rate_lost,
lo_lead_lead_action_per_lead_rate_won,
lo_lead_lead_action_per_lead_rate,
lo_lead_lead_action_per_lead_won,
lo_lead_lead_action_per_lead,
lo_lead_lead_action_rate_lost,
lo_lead_lead_action_rate_won,
lo_lead_lead_action_rate,
lo_lead_lead_action_won,
lo_lead_lead_action,
lo_lead_lo_action_lost,
lo_lead_lo_action_per_lead_lost,
lo_lead_lo_action_per_lead_rate_lost,
lo_lead_lo_action_per_lead_rate_won,
lo_lead_lo_action_per_lead_rate,
lo_lead_lo_action_per_lead_won,
lo_lead_lo_action_per_lead,
lo_lead_lo_action_rate_lost,
lo_lead_lo_action_rate_won,
lo_lead_lo_action_rate,
lo_lead_lo_action_won,
lo_lead_lo_action,
lo_lead_lost,
lo_lead_negative_lost,
lo_lead_negative_per_lead_lost,
lo_lead_negative_per_lead_rate_lost,
lo_lead_negative_per_lead_rate_won,
lo_lead_negative_per_lead_rate,
lo_lead_negative_per_lead_won,
lo_lead_negative_per_lead,
lo_lead_negative_rate_lost,
lo_lead_negative_rate_won,
lo_lead_negative_rate,
lo_lead_negative_won,
lo_lead_negative,
lo_lead_qualification_2017,
lo_lead_qualification,
lo_lead_rate_2017,
lo_lead_rate_lost,
lo_lead_rate_won_2017,
lo_lead_rate_won,
lo_lead_rate,
lo_lead_won_2017,
lo_lead_won,
lo_lead,
lo_qual2close_rate_2017,
lo_qual2close_rate,
lo_qualification_rate_2017,
lo_qualification_rate,
lt_profile_count,
lt_profile,
name_velocify,
name,
nmls_id,
primary_phone,
propair_id,
rec_start_date,
rec_type,
recent_review,
recommend,
regulatory_actions,
role_group,
role_id,
role,
sales_manager,
secondary_phone,
tier,
title,
transfers_to,
updated_at,
veteran,
years_account_lead,
years_account,
years_industry,
zillow_profile_count,
zillow_profile,
zodiac_sign
            ) 
select 
account_end_date,
account_id,
account_start_date,
active,
age,
agent_id,
agent_status_id,
assistant,
avg_tenure,
branch_group,
branch_id,
branch,
brokers_outpost_profile,
channel,
college,
created_at,
days_account_lead,
days_account,
duplicate,
eligible_branch,
email,
employer_count,
encompass_name,
encompass_name2,
fb_profile,
first_name,
gender,
graduation_year,
home_city,
home_country,
home_state,
industry_start_date,
last_name,
license_count,
license_list,
license_status,
license_type,
linkedin_profile,
lo_close_rate_2017,
lo_close_rate,
lo_cluster1_cr,
lo_cluster1,
lo_cluster2_cr,
lo_cluster2,
lo_cluster3_cr,
lo_cluster3,
lo_contact_rate_2017,
lo_contact_rate,
lo_event_all_action_lost,
lo_event_all_action_per_lead_lost,
lo_event_all_action_per_lead_rate_lost,
lo_event_all_action_per_lead_rate_won,
lo_event_all_action_per_lead_rate,
lo_event_all_action_per_lead_won,
lo_event_all_action_per_lead,
lo_event_all_action_rate_lost,
lo_event_all_action_rate_won,
lo_event_all_action_rate,
lo_event_all_action_won,
lo_event_all_action,
lo_event_lead_action_lost,
lo_event_lead_action_per_lead_lost,
lo_event_lead_action_per_lead_rate_lost,
lo_event_lead_action_per_lead_rate_won,
lo_event_lead_action_per_lead_rate,
lo_event_lead_action_per_lead_won,
lo_event_lead_action_per_lead,
lo_event_lead_action_rate_lost,
lo_event_lead_action_rate_won,
lo_event_lead_action_rate,
lo_event_lead_action_won,
lo_event_lead_action,
lo_event_lo_action_lost,
lo_event_lo_action_per_lead_lost,
lo_event_lo_action_per_lead_rate_lost,
lo_event_lo_action_per_lead_rate_won,
lo_event_lo_action_per_lead_rate,
lo_event_lo_action_per_lead_won,
lo_event_lo_action_per_lead,
lo_event_lo_action_rate_lost,
lo_event_lo_action_rate_won,
lo_event_lo_action_rate,
lo_event_lo_action_won,
lo_event_lo_action,
lo_event_lost,
lo_event_negative_lost,
lo_event_negative_per_lead_lost,
lo_event_negative_per_lead_rate_lost,
lo_event_negative_per_lead_rate_won,
lo_event_negative_per_lead_rate,
lo_event_negative_per_lead_won,
lo_event_negative_per_lead,
lo_event_negative_rate_lost,
lo_event_negative_rate_won,
lo_event_negative_rate,
lo_event_negative_won,
lo_event_negative,
lo_event_per_lead_lost,
lo_event_per_lead_won,
lo_event_per_lead,
lo_event_rate_lost,
lo_event_rate_won,
lo_event_rate,
lo_event_won,
lo_event,
lo_lead_2017,
lo_lead_all_action_lost,
lo_lead_all_action_per_lead_lost,
lo_lead_all_action_per_lead_rate_lost,
lo_lead_all_action_per_lead_rate_won,
lo_lead_all_action_per_lead_rate,
lo_lead_all_action_per_lead_won,
lo_lead_all_action_per_lead,
lo_lead_all_action_rate_lost,
lo_lead_all_action_rate_won,
lo_lead_all_action_rate,
lo_lead_all_action_won,
lo_lead_all_action,
lo_lead_contact_2017,
lo_lead_contact,
lo_lead_lead_action_lost,
lo_lead_lead_action_per_lead_lost,
lo_lead_lead_action_per_lead_rate_lost,
lo_lead_lead_action_per_lead_rate_won,
lo_lead_lead_action_per_lead_rate,
lo_lead_lead_action_per_lead_won,
lo_lead_lead_action_per_lead,
lo_lead_lead_action_rate_lost,
lo_lead_lead_action_rate_won,
lo_lead_lead_action_rate,
lo_lead_lead_action_won,
lo_lead_lead_action,
lo_lead_lo_action_lost,
lo_lead_lo_action_per_lead_lost,
lo_lead_lo_action_per_lead_rate_lost,
lo_lead_lo_action_per_lead_rate_won,
lo_lead_lo_action_per_lead_rate,
lo_lead_lo_action_per_lead_won,
lo_lead_lo_action_per_lead,
lo_lead_lo_action_rate_lost,
lo_lead_lo_action_rate_won,
lo_lead_lo_action_rate,
lo_lead_lo_action_won,
lo_lead_lo_action,
lo_lead_lost,
lo_lead_negative_lost,
lo_lead_negative_per_lead_lost,
lo_lead_negative_per_lead_rate_lost,
lo_lead_negative_per_lead_rate_won,
lo_lead_negative_per_lead_rate,
lo_lead_negative_per_lead_won,
lo_lead_negative_per_lead,
lo_lead_negative_rate_lost,
lo_lead_negative_rate_won,
lo_lead_negative_rate,
lo_lead_negative_won,
lo_lead_negative,
lo_lead_qualification_2017,
lo_lead_qualification,
lo_lead_rate_2017,
lo_lead_rate_lost,
lo_lead_rate_won_2017,
lo_lead_rate_won,
lo_lead_rate,
lo_lead_won_2017,
lo_lead_won,
lo_lead,
lo_qual2close_rate_2017,
lo_qual2close_rate,
lo_qualification_rate_2017,
lo_qualification_rate,
lt_profile_count,
lt_profile,
name_velocify,
name,
nmls_id,
primary_phone,
propair_id,
rec_start_date,
rec_type,
recent_review,
recommend,
regulatory_actions,
role_group,
role_id,
role,
sales_manager,
secondary_phone,
tier,
title,
transfers_to,
updated_at,
veteran,
years_account_lead,
years_account,
years_industry,
zillow_profile_count,
zillow_profile,
zodiac_sign
from agent_profiles_stage ;

delete from agent_profiles_stage;

END;
$$ language plpgsql 
